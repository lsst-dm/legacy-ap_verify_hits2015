description: Instrumented Alert Production pipeline specialized for CI-HiTS-2015
#
# This pipeline delegates to per-task config files to ensure consistency with Gen 2.
# The config files can be merged into this once ap_verify no longer supports Gen 2.
#
# This pipeline does not depend on the local ApPipe.yaml, because the definition
# of the primary ApVerify.yaml is more likely to change than the data-specific
# overrides, and importing both pipelines can't merge changes to the same task.

imports:
  - location: $AP_VERIFY_DIR/pipelines/DarkEnergyCamera/ApVerify.yaml
parameters:
  coaddName: deep
  # TODO: redundant connection definitions workaround for DM-30210
  template: deepCoadd
  diaSrcCat: deepDiff_diaSrc
  diaSrcSchema: deepDiff_diaSrc_schema
  diaSrcParquet: deepDiff_diaSrcTable
  diff: deepDiff_differenceExp
  diffScore: deepDiff_scoreExp
  diffWarp: deepDiff_warpedExp
  diffMatch: deepDiff_matchedExp
  assocSrc: deepDiff_assocDiaSrc
  # TODO: end DM-30210 workaround
tasks:
  isr:
    class: lsst.ip.isr.IsrTask
    config:
      # Ignore missing calibrations
      file: $AP_VERIFY_HITS2015_DIR/config/isr.py
  calibrate:
    class: lsst.pipe.tasks.calibrate.CalibrateTask
    config:
      # Use dataset's reference catalogs
      file: $AP_VERIFY_HITS2015_DIR/config/calibrate.py
  imageDifference:
    class: lsst.pipe.tasks.imageDifference.ImageDifferenceTask
    config:
      # Use dataset's specific templates
      file: $AP_VERIFY_HITS2015_DIR/config/imageDifference.py
  transformDiaSrcCat:
    class: lsst.ap.association.TransformDiaSourceCatalogTask
    config:
      file: $AP_VERIFY_HITS2015_DIR/config/transformDiaSrcCat.py
  diaPipe:
    class: lsst.ap.association.DiaPipelineTask
    config:
      file: $AP_VERIFY_HITS2015_DIR/config/diaPipe.py
